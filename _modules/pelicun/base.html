

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pelicun.base &mdash; pelicun  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=f9bf6728" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="../../_static/hide_empty_pre.js?v=a807066b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #F2F2F2" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/pelicun-Logo-grey.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/license.html">1. Copyright and license</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/cite.html">2. Citing pelicun</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/cite.html#logo">3. Logo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/acknowledgments.html">4. Acknowledgments</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about/acknowledgments.html#national-science-foundation">4.1. National Science Foundation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/acknowledgments.html#contributors">4.2. Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes/index.html">5. Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes/index.html#version-3-0">5.1. Version 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes/index.html#version-2-0">5.2. Version 2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes/index.html#version-1-0">5.3. Version 1.0</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/install.html">1. Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/install.html#staying-up-to-date">1.1. Staying up to date</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/pelicun_framework.html">2. The Pelicun Framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#abbreviations">2.1. Abbreviations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#introduction-to-pelicun">2.2. Introduction to Pelicun</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#overview">2.3. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#performance-assessment-workflow">2.4. Performance Assessment Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#response-model">2.5. Response Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#performance-model">2.6. Performance Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#damage-model">2.7. Damage Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#loss-model">2.8. Loss Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/feature_overview.html">3. Overview of pelicun features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/feature_overview.html#saving-loading-samples">3.1. Saving/loading samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/feature_overview.html#logging-support">3.2. Logging support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/feature_overview.html#uncertainty-quantification">3.3. Uncertainty quantification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/feature_overview.html#assessment-types">3.4. Assessment types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/feature_overview.html#demand-simulation">3.5. Demand simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/feature_overview.html#damage-estimation">3.6. Damage estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/feature_overview.html#loss-estimation">3.7. Loss estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/feature_overview.html#command-line-support">3.8. Command-line support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/feature_overview.html#standalone-tools">3.9. Standalone tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/feature_overview.html#feature-overview-and-examples">3.10. Feature overview and examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/damage_and_loss_library.html">4. Damage and loss library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/bug_reports_and_feature_requests.html">5. Bug reports and feature requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/resources_for_new_python_users.html">6. Resources for new python users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">7. Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/notebooks/example_1.html">7.1. Example 1: Simple loss function.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/notebooks/example_2.html">7.2. Example 2: Damage state validation.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/notebooks/example_3.html">7.3. Example 3: Combining fragility-based damage consequences and loss functions.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference/index.html">8. API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference/_autosummary/pelicun.html">8.1. pelicun</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/getting_started.html">1. Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/getting_started.html#code-of-conduct">1.1. Code of conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/getting_started.html#how-to-contribute">1.2. How to contribute</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/development_environment.html">2. Setting up a development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/code_quality.html">3. Coding practice</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/code_quality.html#code-quality-assurance">3.1. Code quality assurance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/code_quality.html#unit-tests">3.2. Unit tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/code_quality.html#documentation">3.3. Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/internals.html">4. Package architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/internals.html#overview-of-files">4.1. Overview of files</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #F2F2F2" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pelicun</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pelicun.base</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pelicun.base</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Copyright (c) 2018 Leland Stanford Junior University</span>
<span class="c1"># Copyright (c) 2018 The Regents of the University of California</span>
<span class="c1">#</span>
<span class="c1"># This file is part of pelicun.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions are met:</span>
<span class="c1">#</span>
<span class="c1"># 1. Redistributions of source code must retain the above copyright notice,</span>
<span class="c1"># this list of conditions and the following disclaimer.</span>
<span class="c1">#</span>
<span class="c1"># 2. Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="c1"># this list of conditions and the following disclaimer in the documentation</span>
<span class="c1"># and/or other materials provided with the distribution.</span>
<span class="c1">#</span>
<span class="c1"># 3. Neither the name of the copyright holder nor the names of its contributors</span>
<span class="c1"># may be used to endorse or promote products derived from this software without</span>
<span class="c1"># specific prior written permission.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="c1"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="c1"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="c1"># ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE</span>
<span class="c1"># LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<span class="c1"># CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<span class="c1"># SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<span class="c1"># INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<span class="c1"># CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<span class="c1"># ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<span class="c1"># POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the BSD 3-Clause License along with</span>
<span class="c1"># pelicun. If not, see &lt;http://www.opensource.org/licenses/&gt;.</span>
<span class="c1">#</span>
<span class="c1"># Contributors:</span>
<span class="c1"># Adam Zsarn√≥czay</span>
<span class="c1"># John Vouvakis Manousakis</span>


<span class="sd">&quot;&quot;&quot;Constants, basic classes, and methods for pelicun.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pprint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">overload</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">colorama</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">colorama</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fore</span><span class="p">,</span> <span class="n">Style</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">interp1d</span>  <span class="c1"># type: ignore</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pelicun.pelicun_warnings</span><span class="w"> </span><span class="kn">import</span> <span class="n">PelicunWarning</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">TracebackType</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">pelicun.assessment</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssessmentBase</span>


<span class="n">colorama</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="c1"># set printing options</span>
<span class="n">pp</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span> <span class="o">-</span> <span class="mi">24</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_columns</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">expand_frame_repr</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">300</span>

<span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>


<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Options">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.Options">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Options</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analysis options and logging configuration.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    sampling_method: str</span>
<span class="sd">        Sampling method to use. Specified in the user&#39;s configuration</span>
<span class="sd">        dictionary, otherwise left as provided in the default configuration</span>
<span class="sd">        file (see settings/default_config.json in the pelicun source</span>
<span class="sd">        code). Can be any of [&#39;LHS&#39;, &#39;LHS_midpoint&#39;,</span>
<span class="sd">        &#39;MonteCarlo&#39;]. The default is &#39;LHS&#39;.</span>
<span class="sd">    units_file: str</span>
<span class="sd">        Location of a user-specified units file, which should contain</span>
<span class="sd">        the names of supported units and their conversion factors (the</span>
<span class="sd">        value some quantity of a given unit needs to be multiplied to</span>
<span class="sd">        be expressed in the base units). Value specified in the user</span>
<span class="sd">        configuration dictionary. Pelicun comes with a set of default</span>
<span class="sd">        units which are always loaded (see</span>
<span class="sd">        `settings/default_units.json` in the pelicun source</span>
<span class="sd">        code). Units specified in the units_file overwrite the default</span>
<span class="sd">        units.</span>
<span class="sd">    demand_offset: dict</span>
<span class="sd">        Demand offsets are used in the process of mapping a component</span>
<span class="sd">        location to its associated EDP. This allows components that</span>
<span class="sd">        are sensitive to EDPs of different levels to be specified as</span>
<span class="sd">        present at the same location (e.g. think of desktop computer</span>
<span class="sd">        and suspended ceiling, both at the same story). Each</span>
<span class="sd">        component&#39;s offset value is specified in the component</span>
<span class="sd">        fragility database. This setting applies a supplemental global</span>
<span class="sd">        offset to specific EDP types. The value is specified in the</span>
<span class="sd">        user&#39;s configuration dictionary, otherwise left as provided in</span>
<span class="sd">        the default configuration file (see</span>
<span class="sd">        settings/default_config.json in the pelicun source code).</span>
<span class="sd">    nondir_multi_dict: dict</span>
<span class="sd">        Nondirectional components are sensitive to demands coming in</span>
<span class="sd">        any direction. Results are typically available in two</span>
<span class="sd">        orthogonal directions. FEMA P-58 suggests using the formula</span>
<span class="sd">        `max(dir_1, dir_2) * 1.2` to estimate the demand for such</span>
<span class="sd">        components. This parameter allows modifying the 1.2 multiplier</span>
<span class="sd">        with a user-specified value. The change can be applied to</span>
<span class="sd">        &quot;ALL&quot; EDPs, or for specific EDPs, such as &quot;PFA&quot;, &quot;PFV&quot;,</span>
<span class="sd">        etc. The value is specified in the user&#39;s configuration</span>
<span class="sd">        dictionary, otherwise left as provided in the default</span>
<span class="sd">        configuration file (see settings/default_config.json in the</span>
<span class="sd">        pelicun source code).</span>
<span class="sd">    rho_cost_time: float</span>
<span class="sd">        Specifies the correlation between the repair cost and repair</span>
<span class="sd">        time consequences. The value is specified in the user&#39;s</span>
<span class="sd">        configuration dictionary, otherwise left as provided in the</span>
<span class="sd">        default configuration file (see</span>
<span class="sd">        &quot;RepairCostAndTimeCorrelation&quot;) (see</span>
<span class="sd">        settings/default_config.json in the pelicun source code).</span>
<span class="sd">    eco_scale: dict</span>
<span class="sd">        Controls how the effects of economies of scale are handled in</span>
<span class="sd">        the damaged component quantity aggregation for loss measure</span>
<span class="sd">        estimation. The dictionary is specified in the user&#39;s</span>
<span class="sd">        configuration dictionary, otherwise left as provided in the</span>
<span class="sd">        default configuration file (see settings/default_config.json</span>
<span class="sd">        in the pelicun source code).</span>
<span class="sd">    log: Logger</span>
<span class="sd">        Logger object. Configuration parameters coming from the user&#39;s</span>
<span class="sd">        configuration dictionary or the default configuration file</span>
<span class="sd">        control logging behavior. See Logger class.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;_asmnt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_rng&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_seed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;defaults&#39;</span><span class="p">,</span>
        <span class="s1">&#39;demand_offset&#39;</span><span class="p">,</span>
        <span class="s1">&#39;eco_scale&#39;</span><span class="p">,</span>
        <span class="s1">&#39;eco_scale&#39;</span><span class="p">,</span>
        <span class="s1">&#39;error_setup&#39;</span><span class="p">,</span>
        <span class="s1">&#39;error_setup&#39;</span><span class="p">,</span>
        <span class="s1">&#39;list_all_ds&#39;</span><span class="p">,</span>
        <span class="s1">&#39;log&#39;</span><span class="p">,</span>
        <span class="s1">&#39;log&#39;</span><span class="p">,</span>
        <span class="s1">&#39;nondir_multi_dict&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rho_cost_time&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sampling_method&#39;</span><span class="p">,</span>
        <span class="s1">&#39;units_file&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_config_options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">assessment</span><span class="p">:</span> <span class="n">AssessmentBase</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize an Options object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        user_config_options: dict, Optional</span>
<span class="sd">            User-specified configuration dictionary. Any provided</span>
<span class="sd">            user_config_options override the defaults.</span>
<span class="sd">        assessment: AssessmentBase, Optional</span>
<span class="sd">            Assessment object that will be using this Options</span>
<span class="sd">            object. If it is not intended to use this Options object</span>
<span class="sd">            for an Assessment (e.g. defining an Options object for UQ</span>
<span class="sd">            use), this value should be None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asmnt</span> <span class="o">=</span> <span class="n">assessment</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampling_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_all_ds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">merged_config_options</span> <span class="o">=</span> <span class="n">merge_default_config</span><span class="p">(</span><span class="n">user_config_options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;Seed&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampling_method</span> <span class="o">=</span> <span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;Sampling&#39;</span><span class="p">][</span><span class="s1">&#39;SamplingMethod&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_all_ds</span> <span class="o">=</span> <span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;ListAllDamageStates&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">units_file</span> <span class="o">=</span> <span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;UnitsFile&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">demand_offset</span> <span class="o">=</span> <span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;DemandOffset&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nondir_multi_dict</span> <span class="o">=</span> <span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;NonDirectionalMultipliers&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho_cost_time</span> <span class="o">=</span> <span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;RepairCostAndTimeCorrelation&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eco_scale</span> <span class="o">=</span> <span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;EconomiesOfScale&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error_setup</span> <span class="o">=</span> <span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;ErrorSetup&#39;</span><span class="p">]</span>

        <span class="c1"># instantiate a Logger object with the finalized configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span>
            <span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;LogFile&#39;</span><span class="p">],</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;Verbose&#39;</span><span class="p">],</span>
            <span class="n">log_show_ms</span><span class="o">=</span><span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;LogShowMS&#39;</span><span class="p">],</span>
            <span class="n">print_log</span><span class="o">=</span><span class="n">merged_config_options</span><span class="p">[</span><span class="s1">&#39;PrintLog&#39;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Seed property.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            Seed value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span>

    <span class="nd">@seed</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Seed property setter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seed</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rng</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rng property.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Generator</span>
<span class="sd">            Random generator</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span></div>



<span class="c1"># Define a module-level LoggerRegistry</span>
<div class="viewcode-block" id="LoggerRegistry">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.LoggerRegistry">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LoggerRegistry</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Registry to manage all logger instances.&quot;&quot;&quot;</span>

    <span class="n">_loggers</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Logger</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># The @classmethod decorator allows this method to be called on</span>
    <span class="c1"># the class itself, rather than on instances. It interacts with</span>
    <span class="c1"># class-level data (like _loggers), enabling a single registry for</span>
    <span class="c1"># all Logger instances without needing an object of LoggerRegistry</span>
    <span class="c1"># itself.</span>
<div class="viewcode-block" id="LoggerRegistry.register">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.LoggerRegistry.register">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a logger instance.&quot;&quot;&quot;</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_loggers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span></div>


<div class="viewcode-block" id="LoggerRegistry.log_exception">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.LoggerRegistry.log_exception">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">log_exception</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">exc_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
        <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
        <span class="n">exc_traceback</span><span class="p">:</span> <span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log exceptions to all registered loggers.&quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unhandled exception occurred:&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span><span class="w"> </span><span class="n">exc_value</span><span class="p">,</span><span class="w"> </span><span class="n">exc_traceback</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">logger</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_loggers</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="c1"># Also call the default excepthook to print the exception to</span>
        <span class="c1"># the console as is done by default.</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">__excepthook__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">)</span></div>
</div>



<span class="c1"># Update sys.excepthook to log exceptions in all loggers</span>
<span class="c1"># https://docs.python.org/3/library/sys.html#sys.excepthook</span>
<span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="n">LoggerRegistry</span><span class="o">.</span><span class="n">log_exception</span>


<div class="viewcode-block" id="Logger">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.Logger">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Logger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate log files documenting execution events.&quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;emitted&#39;</span><span class="p">,</span>
        <span class="s1">&#39;log_div&#39;</span><span class="p">,</span>
        <span class="s1">&#39;log_file&#39;</span><span class="p">,</span>
        <span class="s1">&#39;log_show_ms&#39;</span><span class="p">,</span>
        <span class="s1">&#39;log_time_format&#39;</span><span class="p">,</span>
        <span class="s1">&#39;print_log&#39;</span><span class="p">,</span>
        <span class="s1">&#39;spaces&#39;</span><span class="p">,</span>
        <span class="s1">&#39;verbose&#39;</span><span class="p">,</span>
        <span class="s1">&#39;warning_file&#39;</span><span class="p">,</span>
        <span class="s1">&#39;warning_stack&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">log_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">log_show_ms</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">print_log</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a Logger object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        verbose: bool</span>
<span class="sd">            If True, the pelicun echoes more information throughout the</span>
<span class="sd">            assessment.  This can be useful for debugging purposes. The</span>
<span class="sd">            value is specified in the user&#39;s configuration dictionary,</span>
<span class="sd">            otherwise left as provided in the default configuration file</span>
<span class="sd">            (see settings/default_config.json in the pelicun source code).</span>
<span class="sd">        log_show_ms: bool</span>
<span class="sd">            If True, the timestamps in the log file are in microsecond</span>
<span class="sd">            precision. The value is specified in the user&#39;s configuration</span>
<span class="sd">            dictionary, otherwise left as provided in the default</span>
<span class="sd">            configuration file (see settings/default_config.json in the</span>
<span class="sd">            pelicun source code).</span>
<span class="sd">        log_file: str, optional</span>
<span class="sd">            If a value is provided, the log is written to that file. The</span>
<span class="sd">            value is specified in the user&#39;s configuration dictionary,</span>
<span class="sd">            otherwise left as provided in the default configuration file</span>
<span class="sd">            (see settings/default_config.json in the pelicun source code).</span>
<span class="sd">        print_log: bool</span>
<span class="sd">            If True, the log is also printed to standard output. The</span>
<span class="sd">            value is specified in the user&#39;s configuration dictionary,</span>
<span class="sd">            otherwise left as provided in the default configuration file</span>
<span class="sd">            (see settings/default_config.json in the pelicun source code).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_show_ms</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">log_show_ms</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">log_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">split_file_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_warnings&#39;</span> <span class="o">+</span> <span class="n">extension</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warning_file</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span> <span class="o">=</span> <span class="n">str2bool</span><span class="p">(</span><span class="n">print_log</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warning_stack</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emitted</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_log_strings</span><span class="p">()</span>
        <span class="n">control_warnings</span><span class="p">()</span>

        <span class="c1"># Register the logger to the LoggerRegistry in order to</span>
        <span class="c1"># capture raised exceptions.</span>
        <span class="n">LoggerRegistry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Logger.reset_log_strings">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.Logger.reset_log_strings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset_log_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Populate the string-related attributes of the logger.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_show_ms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_time_format</span> <span class="o">=</span> <span class="s1">&#39;%H:%M:%S:</span><span class="si">%f</span><span class="s1">&#39;</span>
            <span class="c1"># the length of the time string in the log file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spaces</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">16</span>
            <span class="c1"># to have a total length of 80 with the time added</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_div</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="mi">17</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_time_format</span> <span class="o">=</span> <span class="s1">&#39;%H:%M:%S&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spaces</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">9</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_div</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span></div>


<div class="viewcode-block" id="Logger.msg">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.Logger.msg">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">msg</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">prepend_timestamp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">prepend_blank_space</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a message in the log file with the current time as prefix.</span>

<span class="sd">        The time is in ISO-8601 format, e.g. 2018-06-16T20:24:04Z</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg: string</span>
<span class="sd">            Message to print.</span>
<span class="sd">        prepend_timestamp: bool</span>
<span class="sd">            Controls whether a timestamp is placed before the message.</span>
<span class="sd">        prepend_blank_space: bool</span>
<span class="sd">            Controls whether blank space is placed before the message.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg_lines</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">msg_i</span><span class="p">,</span> <span class="n">msg_line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">msg_lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">prepend_timestamp</span> <span class="ow">and</span> <span class="p">(</span><span class="n">msg_i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">formatted_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_time_format</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">msg_line</span><span class="si">}</span><span class="s1">&#39;</span>  <span class="c1"># noqa: DTZ005</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">prepend_timestamp</span> <span class="ow">or</span> <span class="n">prepend_blank_space</span><span class="p">:</span>
                <span class="n">formatted_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spaces</span> <span class="o">+</span> <span class="n">msg_line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">formatted_msg</span> <span class="o">=</span> <span class="n">msg_line</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_log</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">formatted_msg</span><span class="p">)</span>  <span class="c1"># noqa: T201</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">formatted_msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="Logger.add_warning">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.Logger.add_warning">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a warning to the warning stack.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Warnings are only emitted when `emit_warnings` is called.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg: str</span>
<span class="sd">            The warning message.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg_lines</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">formatted_msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">msg_line</span> <span class="ow">in</span> <span class="n">msg_lines</span><span class="p">:</span>
            <span class="n">formatted_msg</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spaces</span> <span class="o">+</span> <span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="n">msg_line</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">formatted_msg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">warning_stack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatted_msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="Logger.emit_warnings">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.Logger.emit_warnings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">emit_warnings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Issues all warnings and clears the warning stack.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">warning_stack</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">message</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emitted</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">PelicunWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warning_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warning_file</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">Fore</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spaces</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">emitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emitted</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warning_stack</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warning_stack</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Logger.warning">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.Logger.warning">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an emit a warning immediately.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg: str</span>
<span class="sd">            Warning message</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit_warnings</span><span class="p">()</span></div>


<div class="viewcode-block" id="Logger.div">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.Logger.div">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">prepend_timestamp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a divider line in the log file.&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_div</span> <span class="k">if</span> <span class="n">prepend_timestamp</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">prepend_timestamp</span><span class="o">=</span><span class="n">prepend_timestamp</span><span class="p">)</span></div>


<div class="viewcode-block" id="Logger.print_system_info">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.Logger.print_system_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_system_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write system information in the log.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
            <span class="s1">&#39;System Information:&#39;</span><span class="p">,</span> <span class="n">prepend_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prepend_blank_space</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span>  <span class="c1"># noqa: DTZ005</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;local time zone: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">tzinfo</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;start time: </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;python: </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;numpy: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;pandas: </span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">prepend_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<span class="c1"># get the absolute path of the pelicun directory</span>
<span class="n">pelicun_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span>


<div class="viewcode-block" id="split_file_name">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.split_file_name">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">split_file_name</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Separate a file name from the extension.</span>

<span class="sd">    Separates a file name from the extension accounting for the case</span>
<span class="sd">    where the file name itself contains periods.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_path: str</span>
<span class="sd">        Original file path.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        name: str</span>
<span class="sd">            Name of the file.</span>
<span class="sd">        extension: str</span>
<span class="sd">            File extension.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">stem</span>
    <span class="n">extension</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">extension</span></div>



<div class="viewcode-block" id="control_warnings">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.control_warnings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">control_warnings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Turn warnings on/off.</span>

<span class="sd">        See also: `pelicun/pytest.ini`. Devs: make sure to update that</span>
<span class="sd">        file when addressing &amp; eliminating warnings.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">warnoptions</span><span class="p">:</span>
        <span class="c1"># Here we specify *specific* warnings to ignore.</span>
        <span class="c1"># &#39;message&#39; -- a regex that the warning message must match</span>

        <span class="c1"># Note: we ignore known warnings emitted from our dependencies</span>
        <span class="c1"># and plan to address them soon.</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;.*Use to_numeric without passing `errors`.*&#39;</span>
        <span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*errors=&#39;ignore&#39; is deprecated.*&quot;</span>
        <span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;.*The previous implementation of stack is deprecated.*&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;.*Setting an item of incompatible dtype is deprecated.*&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;.*DataFrame.groupby with axis=1 is deprecated.*&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="load_default_options">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.load_default_options">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_default_options</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the default_config.json file to set options to default values.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Default options</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">pelicun_path</span> <span class="o">/</span> <span class="s1">&#39;settings/default_config.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
        <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">default_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">default_config</span><span class="p">[</span><span class="s1">&#39;Options&#39;</span><span class="p">]</span></div>



<div class="viewcode-block" id="update_vals">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.update_vals">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_vals</span><span class="p">(</span>
    <span class="n">update_value</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">primary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">update_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">primary_path</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transfer values between nested dictionaries.</span>

<span class="sd">    Updates the values of the `update` nested dictionary with</span>
<span class="sd">    those provided in the `primary` nested dictionary. If a key</span>
<span class="sd">    already exists in update, and does not map to another</span>
<span class="sd">    dictionary, the value is left unchanged.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    update_value: dict</span>
<span class="sd">        Dictionary -which can contain nested dictionaries- to be</span>
<span class="sd">        updated based on the values of `primary`. New keys existing</span>
<span class="sd">        in `primary` are added to `update`. Values of which keys</span>
<span class="sd">        already exist in `primary` are left unchanged.</span>
<span class="sd">    primary: dict</span>
<span class="sd">        Dictionary -which can contain nested dictionaries- to</span>
<span class="sd">        be used to update the values of `update`.</span>
<span class="sd">    update_path: str</span>
<span class="sd">        Identifier for the update dictionary. Used to make error</span>
<span class="sd">        messages more meaningful.</span>
<span class="sd">    primary_path: str</span>
<span class="sd">        Identifier for the update dictionary. Used to make error</span>
<span class="sd">        messages more meaningful.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">      If primary[key] is dict but update[key] is not.</span>
<span class="sd">    ValueError</span>
<span class="sd">      If update[key] is dict but primary[key] is not.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># we go over the keys of `primary`</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">primary</span><span class="p">:</span>  <span class="c1"># noqa: PLC0206</span>
        <span class="c1"># if `primary[key]` is a dictionary:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">primary</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># if the same `key` does not exist in update,</span>
            <span class="c1"># we associate it with an empty dictionary.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">update_value</span><span class="p">:</span>
                <span class="n">update_value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># if it exists already, it should map to</span>
            <span class="c1"># a dictionary.</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">update_value</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">update_path</span><span class="si">}</span><span class="s1">[&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;] &#39;</span>
                    <span class="s1">&#39;should map to a dictionary. &#39;</span>
                    <span class="s1">&#39;The specified value is &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">update_path</span><span class="si">}</span><span class="s1">[&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;] = </span><span class="si">{</span><span class="n">update_value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">, but &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;the default value is &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">primary_path</span><span class="si">}</span><span class="s1">[&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;] = </span><span class="si">{</span><span class="n">primary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">. &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;Please revise </span><span class="si">{</span><span class="n">update_path</span><span class="si">}</span><span class="s1">[&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;].&#39;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># With both being dictionaries, we use recursion.</span>
            <span class="n">update_vals</span><span class="p">(</span>
                <span class="n">update_value</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                <span class="n">primary</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">update_path</span><span class="si">}</span><span class="s1">[&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">primary_path</span><span class="si">}</span><span class="s1">[&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># if `primary[key]` is NOT a dictionary:</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">update_value</span><span class="p">:</span>
            <span class="n">update_value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">primary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">update_value</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">update_path</span><span class="si">}</span><span class="s1">[&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;] &#39;</span>
                <span class="s1">&#39;should not map to a dictionary. &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;The specified value is &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">update_path</span><span class="si">}</span><span class="s1">[&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;] = </span><span class="si">{</span><span class="n">update_value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">, but &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;the default value is &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">primary_path</span><span class="si">}</span><span class="s1">[&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;] = </span><span class="si">{</span><span class="n">primary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">. &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;Please revise </span><span class="si">{</span><span class="n">update_path</span><span class="si">}</span><span class="s1">[&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;].&#39;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>



<div class="viewcode-block" id="merge_default_config">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.merge_default_config">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">merge_default_config</span><span class="p">(</span><span class="n">user_config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge default config with user&#39;s options.</span>

<span class="sd">    Merge the user-specified config with the configuration defined in</span>
<span class="sd">    the default_config.json file. If the user-specified config does</span>
<span class="sd">    not include some option available in the default options, then the</span>
<span class="sd">    default option is used in the merged config.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    user_config: dict</span>
<span class="sd">        User-specified configuration dictionary</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Merged configuration dictionary</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">user_config</span>  <span class="c1"># start from the user&#39;s config</span>
    <span class="n">default_config</span> <span class="o">=</span> <span class="n">load_default_options</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># We fill out the user&#39;s config with the values available in the</span>
    <span class="c1"># default config that were not set.</span>
    <span class="c1"># We use a recursive function to handle nesting.</span>
    <span class="n">update_vals</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">default_config</span><span class="p">,</span> <span class="s1">&#39;user_settings&#39;</span><span class="p">,</span> <span class="s1">&#39;default_settings&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">config</span></div>



<span class="c1"># https://stackoverflow.com/questions/52445559/</span>
<span class="c1"># how-can-i-type-hint-a-function-where-the-</span>
<span class="c1"># return-type-depends-on-the-input-type-o</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_to_SimpleIndex</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span> <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_to_SimpleIndex</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span> <span class="o">...</span>


<div class="viewcode-block" id="convert_to_SimpleIndex">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.convert_to_SimpleIndex">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_to_SimpleIndex</span><span class="p">(</span>  <span class="c1"># noqa: N802</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the index of a DataFrame to a simple, one-level index.</span>

<span class="sd">    The target index uses standard SimCenter convention to identify</span>
<span class="sd">    different levels: a dash character (&#39;-&#39;) is used to separate each</span>
<span class="sd">    level of the index.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data: DataFrame</span>
<span class="sd">        The DataFrame that will be modified.</span>
<span class="sd">    axis: int, optional, default:0</span>
<span class="sd">        Identifies if the index (0) or the columns (1) shall be</span>
<span class="sd">        edited.</span>
<span class="sd">    inplace: bool, optional, default:False</span>
<span class="sd">        If yes, the operation is performed directly on the input</span>
<span class="sd">        DataFrame and not on a copy of it.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        The modified DataFrame</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        When an invalid axis parameter is specified</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">}:</span>
        <span class="n">data_mod</span> <span class="o">=</span> <span class="n">data</span> <span class="k">if</span> <span class="n">inplace</span> <span class="k">else</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># only perform this if there are multiple levels</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">simple_name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">n</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">simple_index</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">id_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">])</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span>
                <span class="p">]</span>

                <span class="n">data_mod</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">simple_index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">simple_name</span><span class="p">)</span>
                <span class="n">data_mod</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">simple_name</span>

        <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># only perform this if there are multiple levels</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">simple_name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">n</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">simple_index</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">id_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">])</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">]</span>

                <span class="n">data_mod</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">simple_index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">simple_name</span><span class="p">)</span>
                <span class="n">data_mod</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">simple_name</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Invalid axis parameter: </span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_mod</span></div>



<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_to_MultiIndex</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span> <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_to_MultiIndex</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span> <span class="o">...</span>


<div class="viewcode-block" id="convert_to_MultiIndex">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.convert_to_MultiIndex">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_to_MultiIndex</span><span class="p">(</span>  <span class="c1"># noqa: N802</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the index of a DataFrame to a MultiIndex.</span>

<span class="sd">    We assume that the index uses standard SimCenter convention to</span>
<span class="sd">    identify different levels: a dash character (&#39;-&#39;) is expected to</span>
<span class="sd">    separate each level of the index.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data: DataFrame</span>
<span class="sd">        The DataFrame that will be modified.</span>
<span class="sd">    axis: int, optional, default:0</span>
<span class="sd">        Identifies if the index (0) or the columns (1) shall be</span>
<span class="sd">        edited.</span>
<span class="sd">    inplace: bool, optional, default:False</span>
<span class="sd">        If yes, the operation is performed directly on the input</span>
<span class="sd">        DataFrame and not on a copy of it.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        The modified DataFrame.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If an invalid axis is specified.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check if the requested axis is already a MultiIndex</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">)))</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">))</span>
    <span class="p">):</span>
        <span class="c1"># if yes, return the data unchanged</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">index_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">index_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Invalid axis parameter: </span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">max_lbl_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="k">for</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">index_labels</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">l_i</span><span class="p">,</span> <span class="n">labels</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">index_labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">!=</span> <span class="n">max_lbl_len</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_lbl_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>  <span class="c1"># noqa: PLW2901</span>
            <span class="n">index_labels</span><span class="p">[</span><span class="n">l_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>

    <span class="n">index_labels_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index_labels</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">index_labels_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data_mod</span> <span class="o">=</span> <span class="n">data</span> <span class="k">if</span> <span class="n">inplace</span> <span class="k">else</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data_mod</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">index_labels_np</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_mod</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">index_labels_np</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_mod</span>

    <span class="k">return</span> <span class="n">data</span></div>



<div class="viewcode-block" id="convert_dtypes">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.convert_dtypes">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_dtypes</span><span class="p">(</span><span class="n">dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert columns to a numeric datatype whenever possible.</span>

<span class="sd">    The function replaces None with NA otherwise columns containing</span>
<span class="sd">    None would continue to have the `object` type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframe: DataFrame</span>
<span class="sd">        The DataFrame that will be modified.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        The modified DataFrame.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">option_context</span><span class="p">(</span><span class="s1">&#39;future.no_silent_downcasting&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>  <span class="c1"># noqa: FBT003</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">option_context</span><span class="p">(</span><span class="s1">&#39;mode.copy_on_write&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>  <span class="c1"># noqa: FBT003</span>
    <span class="p">):</span>
        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">infer_objects</span><span class="p">()</span>
    <span class="c1"># note: `axis=0` applies the function to the columns</span>
    <span class="c1"># note: ignoring errors is a bad idea and should never be done. In</span>
    <span class="c1"># this case, however, that&#39;s not what we do, despite the name of</span>
    <span class="c1"># this parameter. We simply don&#39;t convert the dtype of columns</span>
    <span class="c1"># that cannot be interpreted as numeric. That&#39;s what</span>
    <span class="c1"># `errors=&#39;ignore&#39;` does.</span>
    <span class="c1"># See:</span>
    <span class="c1"># https://pandas.pydata.org/docs/reference/api/pandas.to_numeric.html</span>
    <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">),</span>  <span class="c1"># type:ignore</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="show_matrix">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.show_matrix">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">show_matrix</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">use_describe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print a matrix in a nice way using a DataFrame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data: array-like</span>
<span class="sd">        The matrix data to display. Can be any array-like structure</span>
<span class="sd">        that pandas can convert to a DataFrame.</span>
<span class="sd">    use_describe: bool, default: False</span>
<span class="sd">        If True, provides a descriptive statistical summary of the</span>
<span class="sd">        matrix including specified percentiles.</span>
<span class="sd">        If False, simply prints the matrix as is.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">use_describe</span><span class="p">:</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">])</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>



<div class="viewcode-block" id="multiply_factor_multiple_levels">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.multiply_factor_multiple_levels">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">multiply_factor_multiple_levels</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">raise_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multiply a value to selected rows, in place.</span>

<span class="sd">    Multiplies a value to selected rows of a DataFrame that is indexed</span>
<span class="sd">    with a hierarchical index (pd.MultiIndex). The change is done in</span>
<span class="sd">    place.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df: pd.DataFrame</span>
<span class="sd">        The DataFrame to be modified.</span>
<span class="sd">    conditions: dict</span>
<span class="sd">        A dictionary mapping level names with a single value. Only the</span>
<span class="sd">        rows where the index levels have the provided values will be</span>
<span class="sd">        affected. The dictionary can be empty, in which case all rows</span>
<span class="sd">        will be affected, or contain only some levels and values, in</span>
<span class="sd">        which case only the matching rows will be affected.</span>
<span class="sd">    factor: float</span>
<span class="sd">        Scaling factor to use.</span>
<span class="sd">    axis: int</span>
<span class="sd">        With 0 the condition is checked against the DataFrame&#39;s index,</span>
<span class="sd">        otherwise with 1 it is checked against the DataFrame&#39;s</span>
<span class="sd">        columns.</span>
<span class="sd">    raise_missing: bool</span>
<span class="sd">        Raise an error if no rows are matching the given conditions.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the provided `axis` values is not either 0 or 1.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If there are no rows matching the conditions and raise_missing</span>
<span class="sd">        is True.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">idx_to_use</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">idx_to_use</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Invalid axis: `</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">`&#39;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">idx_to_use</span><span class="p">)</span>

    <span class="c1"># Apply each condition to update the mask</span>
    <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">mask</span> <span class="o">&amp;=</span> <span class="n">idx_to_use</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">raise_missing</span><span class="p">:</span>  <span class="c1"># noqa: E712</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;No rows found matching the conditions: `</span><span class="si">{</span><span class="n">conditions</span><span class="si">}</span><span class="s1">`&#39;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">mask</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span> <span class="o">*=</span> <span class="n">factor</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">mask</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span> <span class="o">*=</span> <span class="n">factor</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_warning</span><span class="p">(</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">category</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="ne">Warning</span><span class="p">],</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">lineno</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: ARG001, ANN401</span>
    <span class="n">line</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: ARG001, ANN401</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display warnings in a custom format.</span>

<span class="sd">    Custom warning function to format and print warnings more</span>
<span class="sd">    attractively. This function modifies how warning messages are</span>
<span class="sd">    displayed, emphasizing the file path and line number from where</span>
<span class="sd">    the warning originated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    message: str</span>
<span class="sd">        The warning message to be displayed.</span>
<span class="sd">    category: Warning</span>
<span class="sd">        The category of the warning (unused, but required for</span>
<span class="sd">        compatibility with standard warning signature).</span>
<span class="sd">    filename: str</span>
<span class="sd">        The path of the file from which the warning is issued. The</span>
<span class="sd">        function simplifies the path for display.</span>
<span class="sd">    lineno: int</span>
<span class="sd">        The line number in the file at which the warning is issued.</span>
<span class="sd">    file: file-like object, optional</span>
<span class="sd">        The target file object to write the warning to (unused, but</span>
<span class="sd">        required for compatibility with standard warning signature).</span>
<span class="sd">    line: str, optional</span>
<span class="sd">        Line of code causing the warning (unused, but required for</span>
<span class="sd">        compatibility with standard warning signature).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint:disable = unused-argument</span>
    <span class="k">if</span> <span class="n">category</span> <span class="o">!=</span> <span class="n">PelicunWarning</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">python_file</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_path</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span> <span class="k">if</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">filename</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;WARNING in </span><span class="si">{</span><span class="n">python_file</span><span class="si">}</span><span class="s1"> at line </span><span class="si">{</span><span class="n">lineno</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># noqa: T201</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>  <span class="c1"># noqa: T201</span>


<span class="n">warnings</span><span class="o">.</span><span class="n">showwarning</span> <span class="o">=</span> <span class="n">_warning</span>  <span class="c1"># type: ignore</span>


<div class="viewcode-block" id="describe">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.describe">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">describe</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">percentiles</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mf">0.001</span><span class="p">,</span>
        <span class="mf">0.023</span><span class="p">,</span>
        <span class="mf">0.10</span><span class="p">,</span>
        <span class="mf">0.159</span><span class="p">,</span>
        <span class="mf">0.5</span><span class="p">,</span>
        <span class="mf">0.841</span><span class="p">,</span>
        <span class="mf">0.90</span><span class="p">,</span>
        <span class="mf">0.977</span><span class="p">,</span>
        <span class="mf">0.999</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extend descriptive statistics.</span>

<span class="sd">    Provides extended descriptive statistics for given data, including</span>
<span class="sd">    percentiles and log standard deviation for applicable columns.</span>
<span class="sd">    This function accepts both pandas Series and DataFrame objects</span>
<span class="sd">    directly, or any array-like structure which can be converted to</span>
<span class="sd">    them. It calculates common descriptive statistics and optionally</span>
<span class="sd">    adds log standard deviation for columns where all values are</span>
<span class="sd">    positive.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data: pd.Series, pd.DataFrame, or array-like</span>
<span class="sd">        The data to describe. If array-like, it is converted to a</span>
<span class="sd">        DataFrame or Series before analysis.</span>
<span class="sd">    percentiles: tuple of float, optional</span>
<span class="sd">        Specific percentiles to include in the output. Default</span>
<span class="sd">        includes an extensive range tailored to provide a detailed</span>
<span class="sd">        summary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        A DataFrame containing the descriptive statistics of the input</span>
<span class="sd">        data, transposed so that each descriptive statistic is a row.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">vals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>

    <span class="c1"># convert Series to a DataFrame</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">desc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">percentiles</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="c1"># add log standard deviation to the stats</span>
    <span class="n">desc</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;log_std&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">T</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">desc</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">desc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;log_std&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]),</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">desc</span></div>



<div class="viewcode-block" id="str2bool">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.str2bool">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">str2bool</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa: FBT001</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a string representation of truth to boolean True or False.</span>

<span class="sd">    This function is designed to convert string inputs that represent</span>
<span class="sd">    boolean values into actual Python boolean types. It handles</span>
<span class="sd">    typical representations of truthiness and falsiness, and is case</span>
<span class="sd">    insensitive.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v: str or bool</span>
<span class="sd">        The value to convert into a boolean. This can be a boolean</span>
<span class="sd">        itself (in which case it is simply returned) or a string that</span>
<span class="sd">        is expected to represent a boolean value.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        The boolean value corresponding to the input.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    argparse.ArgumentTypeError</span>
<span class="sd">        If `v` is a string that does not correspond to a boolean</span>
<span class="sd">        value, an error is raised indicating that a boolean value was</span>
<span class="sd">        expected.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># courtesy of Maxim @ Stackoverflow</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">v</span>
    <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">}:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;False&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">}:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Boolean value expected.&#39;</span>
    <span class="k">raise</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentTypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>



<div class="viewcode-block" id="float_or_None">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.float_or_None">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">float_or_None</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: N802</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert strings to float or None.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string: str</span>
<span class="sd">        A string</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float or None</span>
<span class="sd">        A float, if the given string can be converted to a</span>
<span class="sd">        float. Otherwise, it returns None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="int_or_None">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.int_or_None">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">int_or_None</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: N802</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert strings to int or None.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string: str</span>
<span class="sd">        A string</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int or None</span>
<span class="sd">        An int, if the given string can be converted to an</span>
<span class="sd">        int. Otherwise, it returns None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="check_if_str_is_na">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.check_if_str_is_na">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">check_if_str_is_na</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa: ANN401</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the provided string can be interpreted as N/A.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string: object</span>
<span class="sd">            The string to evaluate</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        The evaluation result. Yes, if the string is considered N/A.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">na_vals</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;N/A&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-1.#QNAN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;null&#39;</span><span class="p">,</span>
        <span class="s1">&#39;None&#39;</span><span class="p">,</span>
        <span class="s1">&#39;&lt;NA&gt;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;nan&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-NaN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;1.#IND&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NaN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;#NA&#39;</span><span class="p">,</span>
        <span class="s1">&#39;1.#QNAN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NULL&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-nan&#39;</span><span class="p">,</span>
        <span class="s1">&#39;#N/A&#39;</span><span class="p">,</span>
        <span class="s1">&#39;#N/A N/A&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n/a&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-1.#IND&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NA&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="c1"># obtained from Pandas&#39; internal STR_NA_VALUES variable.</span>

    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">na_vals</span></div>



<div class="viewcode-block" id="with_parsed_str_na_values">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.with_parsed_str_na_values">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">with_parsed_str_na_values</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Identify string values interpretable as N/A.</span>

<span class="sd">    Given a dataframe, this function identifies values that have</span>
<span class="sd">    string type and can be interpreted as N/A, and replaces them with</span>
<span class="sd">    actual NA&#39;s.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df: pd.DataFrame</span>
<span class="sd">        Dataframe to process</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        The dataframe with proper N/A values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Replace string NA values with actual NaNs</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">check_if_str_is_na</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="dedupe_index">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.dedupe_index">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dedupe_index</span><span class="p">(</span><span class="n">dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a `uid` level to the index.</span>

<span class="sd">    Modifies the index of a DataFrame to ensure all index elements are</span>
<span class="sd">    unique by adding an extra level.  Assumes that the DataFrame&#39;s</span>
<span class="sd">    original index is a MultiIndex with specified names. A unique</span>
<span class="sd">    identifier (&#39;uid&#39;) is added as an additional index level based on</span>
<span class="sd">    the cumulative count of occurrences of the original index</span>
<span class="sd">    combinations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframe: pd.DataFrame</span>
<span class="sd">        The DataFrame whose index is to be modified. It must have a</span>
<span class="sd">        MultiIndex.</span>
<span class="sd">    dtype: type, optional</span>
<span class="sd">        The data type for the new index level &#39;uid&#39;. Defaults to str.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dataframe: pd.DataFrame</span>
<span class="sd">        The original dataframe with an additional `uid` level at the</span>
<span class="sd">        index.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inames</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="o">*</span><span class="n">inames</span><span class="p">])</span><span class="o">.</span><span class="n">cumcount</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="o">*</span><span class="n">inames</span><span class="p">,</span> <span class="s1">&#39;uid&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span></div>



<span class="c1"># Input specs</span>

<span class="n">EDP_to_demand_type</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Drifts</span>
    <span class="s1">&#39;Story Drift Ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;PID&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Interstory Drift Ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;PID&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Roof Drift Ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;PRD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Roof Drift Ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;PRD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Damageable Wall Drift&#39;</span><span class="p">:</span> <span class="s1">&#39;DWD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Racking Drift Ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;RDR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Mega Drift Ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;PMD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Residual Drift Ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;RID&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Residual Interstory Drift Ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;RID&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Effective Drift Ratio&#39;</span><span class="p">:</span> <span class="s1">&#39;EDR&#39;</span><span class="p">,</span>
    <span class="c1"># Floor response</span>
    <span class="s1">&#39;Peak Floor Acceleration&#39;</span><span class="p">:</span> <span class="s1">&#39;PFA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Floor Velocity&#39;</span><span class="p">:</span> <span class="s1">&#39;PFV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Floor Displacement&#39;</span><span class="p">:</span> <span class="s1">&#39;PFD&#39;</span><span class="p">,</span>
    <span class="c1"># Component response</span>
    <span class="s1">&#39;Peak Link Rotation Angle&#39;</span><span class="p">:</span> <span class="s1">&#39;LR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Link Beam Chord Rotation&#39;</span><span class="p">:</span> <span class="s1">&#39;LBR&#39;</span><span class="p">,</span>
    <span class="c1"># Wind Intensity</span>
    <span class="s1">&#39;Peak Gust Wind Speed&#39;</span><span class="p">:</span> <span class="s1">&#39;PWS&#39;</span><span class="p">,</span>
    <span class="c1"># Wind Demands</span>
    <span class="s1">&#39;Peak Wind Force&#39;</span><span class="p">:</span> <span class="s1">&#39;PWF&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Internal Force&#39;</span><span class="p">:</span> <span class="s1">&#39;PIF&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Line Force&#39;</span><span class="p">:</span> <span class="s1">&#39;PLF&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Wind Pressure&#39;</span><span class="p">:</span> <span class="s1">&#39;PWP&#39;</span><span class="p">,</span>
    <span class="c1"># Inundation Intensity</span>
    <span class="s1">&#39;Peak Inundation Height&#39;</span><span class="p">:</span> <span class="s1">&#39;PIH&#39;</span><span class="p">,</span>
    <span class="c1"># Shaking Intensity</span>
    <span class="s1">&#39;Peak Ground Acceleration&#39;</span><span class="p">:</span> <span class="s1">&#39;PGA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Ground Velocity&#39;</span><span class="p">:</span> <span class="s1">&#39;PGV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Spectral Acceleration&#39;</span><span class="p">:</span> <span class="s1">&#39;SA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Spectral Velocity&#39;</span><span class="p">:</span> <span class="s1">&#39;SV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Spectral Displacement&#39;</span><span class="p">:</span> <span class="s1">&#39;SD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Spectral Acceleration&#39;</span><span class="p">:</span> <span class="s1">&#39;SA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Spectral Velocity&#39;</span><span class="p">:</span> <span class="s1">&#39;SV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Peak Spectral Displacement&#39;</span><span class="p">:</span> <span class="s1">&#39;SD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Permanent Ground Deformation&#39;</span><span class="p">:</span> <span class="s1">&#39;PGD&#39;</span><span class="p">,</span>
    <span class="c1"># Placeholder for advanced calculations</span>
    <span class="s1">&#39;One&#39;</span><span class="p">:</span> <span class="s1">&#39;ONE&#39;</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="dict_raise_on_duplicates">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.dict_raise_on_duplicates">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dict_raise_on_duplicates</span><span class="p">(</span><span class="n">ordered_pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct a dictionary from a list of key-value pairs.</span>

<span class="sd">    Constructs a dictionary from a list of key-value pairs, raising an</span>
<span class="sd">    exception if duplicate keys are found.</span>
<span class="sd">    This function ensures that no two pairs have the same key. It is</span>
<span class="sd">    particularly useful when parsing JSON-like data where unique keys</span>
<span class="sd">    are expected but not enforced by standard parsing methods.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ordered_pairs: list of tuples</span>
<span class="sd">        A list of tuples, each containing a key and a value. Keys are</span>
<span class="sd">        expected to be unique across the list.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary constructed from the ordered_pairs without any</span>
<span class="sd">        duplicates.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If a duplicate key is found in the input list, a ValueError is</span>
<span class="sd">        raised with a message indicating the duplicate key.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; dict_raise_on_duplicates(</span>
<span class="sd">    ...     [(&quot;key1&quot;, &quot;value1&quot;), (&quot;key2&quot;, &quot;value2&quot;), (&quot;key1&quot;, &quot;value3&quot;)]</span>
<span class="sd">    ... )</span>
<span class="sd">    ValueError: duplicate key: key1</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This implementation is useful for contexts in which data integrity</span>
<span class="sd">    is crucial and key uniqueness must be ensured.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ordered_pairs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;duplicate key: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">d</span></div>



<div class="viewcode-block" id="parse_units">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.parse_units">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_units</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
    <span class="n">custom_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">preserve_categories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the unit conversion factor JSON file and return a dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    custom_file: str, optional</span>
<span class="sd">        If a custom file is provided, only the units specified in the</span>
<span class="sd">        custom file are used.</span>
<span class="sd">    preserve_categories: bool, optional</span>
<span class="sd">        If True, maintains the original data types of category</span>
<span class="sd">        values from the JSON file. If False, converts all values</span>
<span class="sd">        to floats and flattens the dictionary structure, ensuring</span>
<span class="sd">        that each unit name is globally unique across categories.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary where keys are unit names and values are</span>
<span class="sd">        their corresponding conversion factors. If</span>
<span class="sd">        `preserve_categories` is True, the dictionary may maintain</span>
<span class="sd">        its original nested structure based on the JSON file. If</span>
<span class="sd">        `preserve_categories` is False, the dictionary is flattened</span>
<span class="sd">        to have globally unique unit names.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_contents</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">preserve_categories</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>  <span class="c1"># noqa: C901</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Map unit names to conversion factors.</span>

<span class="sd">        Parses a unit conversion factors JSON file and returns a</span>
<span class="sd">        dictionary mapping unit names to conversion factors.</span>

<span class="sd">        This function allows the use of a custom JSON file for</span>
<span class="sd">        defining unit conversion factors or defaults to a predefined</span>
<span class="sd">        file. It ensures that each unit name is unique and that all</span>
<span class="sd">        conversion factors are float values. Additionally, it supports</span>
<span class="sd">        the option to preserve the original data types of category</span>
<span class="sd">        values from the JSON.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path: str</span>
<span class="sd">            The file path to a JSON file containing unit conversion</span>
<span class="sd">            factors. If not provided, a default file is used.</span>
<span class="sd">        preserve_categories: bool, optional</span>
<span class="sd">            If True, maintains the original data types of category</span>
<span class="sd">            values from the JSON file. If False, converts all values</span>
<span class="sd">            to floats and flattens the dictionary structure, ensuring</span>
<span class="sd">            that each unit name is globally unique across categories.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dictionary where keys are unit names and values are</span>
<span class="sd">            their corresponding conversion factors. If</span>
<span class="sd">            `preserve_categories` is True, the dictionary may maintain</span>
<span class="sd">            its original nested structure based on the JSON file.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        FileNotFoundError</span>
<span class="sd">            If the specified file does not exist.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a unit name is duplicated or other JSON structure issues are present.</span>
<span class="sd">        TypeError</span>
<span class="sd">            If a conversion factor is not a float.</span>
<span class="sd">        TypeError</span>
<span class="sd">            If any value that needs to be converted to float cannot be</span>
<span class="sd">            converted.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; parse_units(&#39;custom_units.json&#39;)</span>
<span class="sd">        { &#39;m&#39;: 1.0, &#39;cm&#39;: 0.01, &#39;mm&#39;: 0.001 }</span>

<span class="sd">        &gt;&gt;&gt; parse_units(&#39;custom_units.json&#39;, preserve_categories=True)</span>
<span class="sd">        { &#39;Length&#39;: {&#39;m&#39;: 1.0, &#39;cm&#39;: 0.01, &#39;mm&#39;: 0.001} }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">dictionary</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">object_pairs_hook</span><span class="o">=</span><span class="n">dict_raise_on_duplicates</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> was not found.&#39;</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> is not a valid JSON file.&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
        <span class="k">for</span> <span class="n">category_dict</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="c1"># ensure all first-level keys point to a dictionary</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> contains first-level keys &#39;</span>
                    <span class="s2">&quot;that don&#39;t point to a dictionary&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># convert values to float</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">category_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">category_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Unit </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> has a value of </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1"> &#39;</span>
                    <span class="s1">&#39;which cannot be interpreted as a float&#39;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="k">if</span> <span class="n">preserve_categories</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dictionary</span>

        <span class="n">flattened</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">unit_name</span><span class="p">,</span> <span class="n">factor</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">[</span><span class="n">category</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">unit_name</span> <span class="ow">in</span> <span class="n">flattened</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">unit_name</span><span class="si">}</span><span class="s1"> defined twice in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">.&#39;</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">flattened</span><span class="p">[</span><span class="n">unit_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">factor</span>

        <span class="k">return</span> <span class="n">flattened</span>

    <span class="k">if</span> <span class="n">custom_file</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_contents</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">custom_file</span><span class="p">),</span> <span class="n">preserve_categories</span><span class="o">=</span><span class="n">preserve_categories</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">get_contents</span><span class="p">(</span>
        <span class="n">pelicun_path</span> <span class="o">/</span> <span class="s1">&#39;settings/default_units.json&#39;</span><span class="p">,</span>
        <span class="n">preserve_categories</span><span class="o">=</span><span class="n">preserve_categories</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="convert_units">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.convert_units">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_units</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
    <span class="n">values</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert numeric values between different units.</span>

<span class="sd">    Supports conversion within a specified category of units and</span>
<span class="sd">    automatically infers the category if not explicitly provided. It</span>
<span class="sd">    maintains the type of the input in the output.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    values: (float | list[float] | np.ndarray)</span>
<span class="sd">      The numeric value(s) to convert.</span>
<span class="sd">    unit: (str)</span>
<span class="sd">      The current unit of the values.</span>
<span class="sd">    to_unit: (str)</span>
<span class="sd">      The target unit to convert the values into.</span>
<span class="sd">    category: (Optional[str])</span>
<span class="sd">      The category of the units (e.g., &#39;length&#39;, &#39;pressure&#39;). If not</span>
<span class="sd">      provided, the category will be inferred based on the provided</span>
<span class="sd">      units.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float or list[float] or np.ndarray</span>
<span class="sd">      The converted value(s) in the target unit, in the same data type</span>
<span class="sd">      as the input values.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">      If the input `values` are not of type float, list, or</span>
<span class="sd">      np.ndarray.</span>
<span class="sd">    ValueError</span>
<span class="sd">      If the `unit`, `to_unit`, or `category` is unknown or if `unit`</span>
<span class="sd">      and `to_unit` are not in the same category.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">values</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Invalid input type for `values`&#39;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># load default units</span>
    <span class="n">all_units</span> <span class="o">=</span> <span class="n">parse_units</span><span class="p">(</span><span class="n">preserve_categories</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># if a category is given use it, otherwise try to determine it</span>
    <span class="k">if</span> <span class="n">category</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_units</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Unknown category: `</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s1">`&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">all_units</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">unt</span> <span class="ow">in</span> <span class="n">unit</span><span class="p">,</span> <span class="n">to_unit</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">unt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Unknown unit: `</span><span class="si">{</span><span class="n">unt</span><span class="si">}</span><span class="s1">`&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unit_category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">all_units</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">all_units</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
                <span class="n">unit_category</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unit_category</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Unknown unit `</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s1">`&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">all_units</span><span class="p">[</span><span class="n">unit_category</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">to_unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;`</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s1">` is a `</span><span class="si">{</span><span class="n">unit_category</span><span class="si">}</span><span class="s1">` unit, but `</span><span class="si">{</span><span class="n">to_unit</span><span class="si">}</span><span class="s1">` &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;is not specified in that category.&#39;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># convert units</span>
    <span class="n">from_factor</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
    <span class="n">to_factor</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="n">to_unit</span><span class="p">]</span>
    <span class="n">new_values</span> <span class="o">=</span> <span class="n">vals</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">from_factor</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">to_factor</span><span class="p">)</span>

    <span class="c1"># return the results in the same type as that of the provided</span>
    <span class="c1"># values</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">new_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">new_values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">new_values</span></div>



<div class="viewcode-block" id="stringterpolation">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.stringterpolation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">stringterpolation</span><span class="p">(</span>
    <span class="n">arguments</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Linear interpolation from strings.</span>

<span class="sd">    Turns a string of specially formatted arguments into a multilinear</span>
<span class="sd">    interpolating function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arguments: str</span>
<span class="sd">        String of arguments containing Y values and X values,</span>
<span class="sd">        separated by a pipe symbol (`|`). Individual values are</span>
<span class="sd">        separated by commas (`,`). Example:</span>
<span class="sd">        arguments = &#39;y1,y2,y3|x1,x2,x3&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Callable</span>
<span class="sd">        A callable interpolating function</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">split</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="invert_mapping">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.invert_mapping">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">invert_mapping</span><span class="p">(</span><span class="n">original_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inverts a dictionary mapping from key to list of values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    original_dict: dict</span>
<span class="sd">        Dictionary with values that are lists of hashable items.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        New dictionary where each item in the original value lists</span>
<span class="sd">        becomes a key and the original key becomes the corresponding</span>
<span class="sd">        value.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If any value in the original dictionary&#39;s value lists appears</span>
<span class="sd">        more than once.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inverted_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">original_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">inverted_dict</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Cannot invert mapping with duplicate values.&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">inverted_dict</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
    <span class="k">return</span> <span class="n">inverted_dict</span></div>



<div class="viewcode-block" id="get">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.get">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span>
    <span class="n">d</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: ANN401</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>  <span class="c1"># noqa: ANN401</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Path-like dictionary value retrieval.</span>

<span class="sd">    Retrieves a value from a nested dictionary using a path with &#39;/&#39;</span>
<span class="sd">    as the separator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    d: dict</span>
<span class="sd">        The dictionary to search.</span>
<span class="sd">    path: str</span>
<span class="sd">        The path to the desired value, with keys separated by &#39;/&#39;.</span>
<span class="sd">    default: Any, optional</span>
<span class="sd">        The value to return if the path is not found. Defaults to</span>
<span class="sd">        None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Any</span>
<span class="sd">        The value found at the specified path, or the default value if</span>
<span class="sd">        the path is not found.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; config = {</span>
<span class="sd">    ...     &quot;DL&quot;: {</span>
<span class="sd">    ...         &quot;Outputs&quot;: {</span>
<span class="sd">    ...             &quot;Format&quot;: {</span>
<span class="sd">    ...                 &quot;JSON&quot;: &quot;desired_value&quot;</span>
<span class="sd">    ...             }</span>
<span class="sd">    ...         }</span>
<span class="sd">    ...     }</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; get(config, &#39;/DL/Outputs/Format/JSON&#39;, default=&#39;default_value&#39;)</span>
<span class="sd">    &#39;desired_value&#39;</span>
<span class="sd">    &gt;&gt;&gt; get(config, &#39;/DL/Outputs/Format/XML&#39;, default=&#39;default_value&#39;)</span>
<span class="sd">    &#39;default_value&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">current_dict</span> <span class="o">=</span> <span class="n">d</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">current_dict</span> <span class="o">=</span> <span class="n">current_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">current_dict</span>  <span class="c1"># noqa: TRY300</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">default</span></div>



<div class="viewcode-block" id="update">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.update">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span>
    <span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>  <span class="c1"># noqa: ANN401</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">only_if_empty_or_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set a value in a nested dictionary using a path with &#39;/&#39; as the separator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    d: dict</span>
<span class="sd">        The dictionary to update.</span>
<span class="sd">    path: str</span>
<span class="sd">        The path to the desired value, with keys separated by &#39;/&#39;.</span>
<span class="sd">    value: Any</span>
<span class="sd">        The value to set at the specified path.</span>
<span class="sd">    only_if_empty_or_none: bool, optional</span>
<span class="sd">        If True, only update the value if it is None or an empty</span>
<span class="sd">        dictionary. Defaults to False.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; d = {}</span>
<span class="sd">    &gt;&gt;&gt; update(d, &#39;x/y/z&#39;, 1)</span>
<span class="sd">    &gt;&gt;&gt; d</span>
<span class="sd">    {&#39;x&#39;: {&#39;y&#39;: {&#39;z&#39;: 1}}}</span>

<span class="sd">    &gt;&gt;&gt; update(d, &#39;x/y/z&#39;, 2, only_if_empty_or_none=True)</span>
<span class="sd">    &gt;&gt;&gt; d</span>
<span class="sd">    {&#39;x&#39;: {&#39;y&#39;: {&#39;z&#39;: 1}}}  # value remains 1 since it is not empty or None</span>

<span class="sd">    &gt;&gt;&gt; update(d, &#39;x/y/z&#39;, 2)</span>
<span class="sd">    &gt;&gt;&gt; d</span>
<span class="sd">    {&#39;x&#39;: {&#39;y&#39;: {&#39;z&#39;: 2}}}  # value is updated to 2</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">current_dict</span> <span class="o">=</span> <span class="n">d</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_dict</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">current_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">current_dict</span> <span class="o">=</span> <span class="n">current_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">only_if_empty_or_none</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_unspecified</span><span class="p">(</span><span class="n">current_dict</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">current_dict</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">current_dict</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span></div>



<div class="viewcode-block" id="is_unspecified">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.is_unspecified">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_unspecified</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if something is specified.</span>

<span class="sd">    Checks if a value in a nested dictionary is either non-existent,</span>
<span class="sd">    None, NaN, or an empty dictionary or list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    d: dict</span>
<span class="sd">        The dictionary to search.</span>
<span class="sd">    path: str</span>
<span class="sd">        The path to the desired value, with keys separated by &#39;/&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the value is non-existent, None, or an empty</span>
<span class="sd">        dictionary or list. False otherwise.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; config = {</span>
<span class="sd">    ...     &quot;DL&quot;: {</span>
<span class="sd">    ...         &quot;Outputs&quot;: {</span>
<span class="sd">    ...             &quot;Format&quot;: {</span>
<span class="sd">    ...                 &quot;JSON&quot;: &quot;desired_value&quot;,</span>
<span class="sd">    ...                 &quot;EmptyDict&quot;: {}</span>
<span class="sd">    ...             }</span>
<span class="sd">    ...         }</span>
<span class="sd">    ...     }</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; is_unspecified(config, &#39;/DL/Outputs/Format/JSON&#39;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; is_unspecified(config, &#39;/DL/Outputs/Format/XML&#39;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; is_unspecified(config, &#39;/DL/Outputs/Format/EmptyDict&#39;)</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="p">{}:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">==</span> <span class="p">[]</span></div>



<div class="viewcode-block" id="is_specified">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.is_specified">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_specified</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opposite of `is_unspecified()`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    d: dict</span>
<span class="sd">        The dictionary to search.</span>
<span class="sd">    path: str</span>
<span class="sd">        The path to the desired value, with keys separated by &#39;/&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the value is specified, False otherwise.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">is_unspecified</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>



<div class="viewcode-block" id="ensure_value">
<a class="viewcode-back" href="../../api_reference/_autosummary/pelicun.base.html#pelicun.base.ensure_value">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ensure_value</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure a variable is not None.</span>

<span class="sd">    This function checks that the provided variable is not None. It is</span>
<span class="sd">    used to assist with type hinting by avoiding repetitive `assert</span>
<span class="sd">    value is not None` statements throughout the code.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    value : Optional[T]</span>
<span class="sd">        The variable to check, which can be of any type or None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    T</span>
<span class="sd">        The same variable, guaranteed to be non-None.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the provided variable is None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>
    <span class="k">return</span> <span class="n">value</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Leland Stanford Junior University and The Regents of the University of California.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-158130480-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-158130480-7', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>